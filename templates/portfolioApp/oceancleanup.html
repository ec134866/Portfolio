{% extends 'base.html'%}
{% load i18n %}
        {% block title %}
          <title> {% trans "The Ocean Cleanup" %} </title>
        {% endblock %}
        
        {% block search %}
        {% endblock %}
        
        {% block content %}

      <br><br><br><br>
        <script>
            async function get_data(){
                const gas_end_point="https://script.google.com/macros/s/AKfycbwrdamlHaEE3WE_zXlsTHZQiYUBLDCEBBQWQhOyvgaWm9G6EXyFAHodwdRvjPv4ZQ-Urw/exec"
                const data_set = "cleanupProjects"

                
                const reply = await fetch(gas_end_point + "?data_set=" + data_set)
                //The request is made of Google App Script and the response is set to "response"
                const response = await reply.json()
                console.log("in get data", response) 





                const container = document.getElementById("data-container");
                container.innerHTML = ""; // Clear previous content

                for (const row of response) {
                    // Create a Bootstrap card for each project
                    const card = document.createElement("div");
                    card.className = "card";
                    card.style.width = "18rem";
                    card.style.margin = "10px"; // Add margin for spacing

                    const cardBody = document.createElement("div");
                    cardBody.className = "card-body";

                    const title = document.createElement("h5");
                    title.className = "card-title";
                    title.innerText = row[0]; // Assuming the first column is the title
                    cardBody.appendChild(title);

                    const subtitle = document.createElement("h6");
                    subtitle.className = "card-subtitle mb-2 text-muted";
                    subtitle.innerText = row[1]; // Assuming the second column is the subtitle
                    cardBody.appendChild(subtitle);

                    // add more columns here

                    card.appendChild(cardBody);
                    container.appendChild(card);
                }
            }
                
                {% comment %} 
                const html=["<table border=1>"]

                // add the Heading
                html.push("<tr>")
                    for(col of response.shift()){
                        html.push("<th>")
                        html.push(col)
                        html.push("</th>")
                    }
                    html.push("</tr>")


                for(const row of response){
                    html.push("<tr>")
                    for(col of row){
                        html.push("<td>")
                        html.push(col)
                        html.push("</td>")
                    }
                    html.push("</tr>")
                }
                html.push("</table>")
                document.getElementById("data-table").innerHTML=html.join("") 
            } 
            {% endcomment %}

        </script>
        <div class="container">
            <div class="row">
                <a href="https://airtable.com/apptoGvHgTQOzemhf/shrULBhIWdHT997J7" target="_blank" style="text-decoration: none; color: black;">
                    <h5>{% trans "The Airtable DB can be reached here" %}</h5>
                </a>
                <br><br><br><br>
                <body onload="get_data()">
                    <div>This is an example of getting data from airtable through Google Apps Script</div>
                    {% comment %} <div id="data-table">Loading data ...</div> {% endcomment %}
                    <div class="row" id="data-container">

                    </div>
                </body>                
            </div>
        </div>

        {% endblock %}